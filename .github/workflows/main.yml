name: CI/CD to Docker Hub and AWS

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: rasel143x/house-price-prediction:latest

  # deploy-to-aws:
  #   needs: build-and-push # Only runs if the build succeeds
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Configure AWS Credentials
  #       uses: aws-actions/configure-aws-credentials@v4
  #       with:
  #         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
  #         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #         aws-region: us-east-1 # Change to your region

  #     - name: Deploy to AWS App Runner
  #       uses: awslabs/amazon-app-runner-deploy@main
  #       with:
  #         service: house-price-predictor
  #         image: rasel143x/house-price-prediction:latest
  #         access-role-arn: ${{ secrets.AWS_ROLE_ARN }}
  #         region: us-east-1
  #         cpu: 1
  #         memory: 2
  #         port: 8000